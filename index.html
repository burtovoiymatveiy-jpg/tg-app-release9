<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ó–∞–∫–∞–∑ —Ä–∞–±–æ—Ç—ã @awarem</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #ffffff; --sec-bg: #f4f4f5; --text: #000000; --hint: #707579;
            --card-border: rgba(0,0,0,0.1); --accent: #3390ec; --accent-red: #ff3b30; --accent-green: #34c759;
            --toggle-off: #dee2e6;
        }
        [data-theme="dark"] {
            --bg: #1c1c1d; --sec-bg: #2c2c2e; --text: #ffffff; --hint: #8e8e93; 
            --card-border: rgba(255,255,255,0.1); --toggle-off: #3a3a3c;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding: 16px;
            display: flex; flex-direction: column; gap: 12px; transition: 0.3s;
        }

        /* –≠–§–§–ï–ö–¢ –§–û–ö–£–°–ê –í–ù–ò–ú–ê–ù–ò–Ø */
        .card { 
            background: var(--sec-bg); border-radius: 16px; padding: 14px; 
            border: 1px solid var(--card-border); 
            transition: transform 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
        }

        /* –ü—Ä–∏–≥–ª—É—à–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        body:has(.card:focus-within) .card:not(:focus-within),
        body:has(.card:focus-within) .header-row,
        body:has(.card:focus-within) .review-notice {
            opacity: 0.5;
            filter: blur(0.4px);
            transform: scale(0.98);
        }

        /* –ù–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .card:focus-within {
            transform: scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(51, 144, 236, 0.25);
            z-index: 10;
        }

        #p-bar { position: fixed; top: 0; left: 0; height: 3px; background: var(--accent); width: 0%; transition: 0.3s; z-index: 100; }
        .header-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; transition: 0.3s; }
        .theme-toggle {
            background: var(--sec-bg); border: 1px solid var(--card-border); 
            border-radius: 50%; width: 42px; height: 42px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;
        }

        label { font-size: 10px; color: var(--hint); font-weight: 800; text-transform: uppercase; margin-bottom: 6px; display: block; }
        input, select, textarea {
            background: var(--bg); border: 1px solid var(--card-border); border-radius: 10px;
            color: var(--text); font-size: 16px; padding: 10px; width: 100%; box-sizing: border-box; outline: none; transition: 0.2s;
        }
        input:focus, textarea:focus { border-color: var(--accent); }
        .urgent-input { border-color: var(--accent-red) !important; color: var(--accent-red) !important; }

        .row { display: flex; gap: 10px; align-items: flex-end; }
        .flex-1 { flex: 1; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-green); }
        .dot-online { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.9); opacity: 1; } 70% { transform: scale(1.2); opacity: 0.5; } 100% { transform: scale(0.9); opacity: 1; } }

        .main-btn { background: var(--accent); color: white; border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: 700; width: 100%; cursor: pointer; margin-top: 4px; }
        .secondary-btn { background: var(--sec-bg); border: 1px solid var(--card-border); color: var(--accent); padding: 11px; border-radius: 12px; font-size: 13px; font-weight: 600; text-align: center; flex: 1; cursor: pointer; width: 100%; }
        
        .preview-box { background: var(--sec-bg); border: 1px dashed var(--accent); border-radius: 12px; padding: 12px; font-family: monospace; font-size: 12px; white-space: pre-line; display: none; margin: 10px 0; }
        .preview-box.show { display: block; }

        .switch-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; }
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--toggle-off); transition: .3s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-green); }
        input:checked + .slider:before { transform: translateX(18px); }

        .review-notice { background: var(--sec-bg); border: 1px dashed var(--accent); border-radius: 12px; padding: 12px; font-size: 11px; text-align: center; transition: 0.3s; }
        .version-footer { font-size: 10px; color: var(--hint); text-align: center; margin-top: 4px; opacity: 0.5; font-weight: 600; }
        .magic-btn { font-size: 10px; background: var(--accent); color: #fff; padding: 4px 8px; border-radius: 6px; float: right; margin-top: -20px; cursor: pointer; }
    </style>
</head>
<body>
<div id="p-bar"></div>

<div class="header-row">
    <div class="secondary-btn" onclick="openLink('https://t.me/txtandpptx')">üì¢ –ö–∞–Ω–∞–ª</div>
    <div class="secondary-btn" onclick="openLink('https://t.me/OTZblBblawarem')">‚≠ê –û—Ç–∑—ã–≤—ã</div>
    <div class="theme-toggle" onclick="toggleTheme()" id="theme-btn">‚òÄÔ∏è</div>
</div>

<div class="card" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 14px;">
    <div style="display: flex; align-items: center; gap: 8px;">
        <div class="status-dot dot-online"></div>
        <span id="welcome-text" style="font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--accent-green);">–°—Ç–∞—Ç—É—Å: –°–≤–æ–±–æ–¥–µ–Ω</span>
    </div>
</div>

<div class="card">
    <label>–í–∏–¥ —Ä–∞–±–æ—Ç—ã</label>
    <select id="type" oninput="update()">
        <option value="–†–µ—Ñ–µ—Ä–∞—Ç">üìù –†–µ—Ñ–µ—Ä–∞—Ç</option>
        <option value="–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è">üìä –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</option>
        <option value="–î–æ–∫–ª–∞–¥">üé§ –î–æ–∫–ª–∞–¥</option>
        <option value="–ü—Ä–æ–µ–∫—Ç">üí° –ü—Ä–æ–µ–∫—Ç</option>
        <option value="–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–µ–∫—Ü–∏—é">üñã –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–µ–∫—Ü–∏—é</option>
    </select>
    
    <div class="row" style="margin-top:12px">
        <div class="flex-1">
            <label id="unit-label">–ö–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü</label>
            <input type="number" id="count" placeholder="0" oninput="update()">
        </div>
        <div class="flex-1">
            <label>–î–µ–¥–ª–∞–π–Ω (–¥–¥.–º–º)</label>
            <input type="text" id="date" maxlength="5" placeholder="18.02" oninput="update()">
        </div>
    </div>
</div>

<div class="card">
    <label>–î–µ—Ç–∞–ª–∏ –∏ –±—é–¥–∂–µ—Ç</label>
    <span class="magic-btn" onclick="genPlan()">‚ú® –ü–ª–∞–Ω</span>
    <textarea id="details" rows="3" placeholder="–¢–µ–º–∞, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ..." oninput="update()"></textarea>
    <div style="margin-top:12px">
        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
        <input type="text" id="price" placeholder="500" oninput="update()">
    </div>
</div>

<div class="card switch-row">
    <span style="font-size: 14px; font-weight: 700;">üö® –°—Ä–æ—á–Ω–æ</span>
    <label class="switch">
        <input type="checkbox" id="urgent" onchange="update()">
        <span class="slider"></span>
    </label>
</div>

<div class="preview-box" id="preview"></div>
<button class="main-btn" onclick="copy()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—É</button>
<button class="secondary-btn" style="color:var(--accent-red); border:none; margin-top:4px" onclick="clearAll()">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>

<div class="review-notice">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è!</div>
<div class="version-footer">BETA 0.30 ‚Ä¢ @awarem</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª—è—Ö
    document.querySelectorAll('input, textarea, select').forEach(el => {
        el.addEventListener('focus', () => tg.HapticFeedback.impactOccurred('light'));
    });

    function setWelcome() {
        const hour = new Date().getHours();
        let msg = (hour >= 5 && hour < 12) ? "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –°–≤–æ–±–æ–¥–µ–Ω ‚òï" :
                  (hour >= 12 && hour < 18) ? "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ù–∞ —Å–≤—è–∑–∏ ‚òÄÔ∏è" :
                  (hour >= 18 && hour < 23) ? "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä! –†–∞–±–æ—Ç–∞—é üåô" : "–ù–æ—á–Ω–æ–π –∑–∞–∫–∞–∑? –ü—Ä–∏–Ω–∏–º–∞—é! ü¶â";
        document.getElementById('welcome-text').innerText = msg;
    }

    function openLink(url) { tg.HapticFeedback.impactOccurred('light'); tg.openTelegramLink(url); }

    function toggleTheme() {
        const isD = document.body.getAttribute('data-theme') === 'dark';
        document.body.setAttribute('data-theme', isD ? 'light' : 'dark');
        document.getElementById('theme-btn').innerText = isD ? '‚òÄÔ∏è' : 'üåô';
        tg.HapticFeedback.impactOccurred('medium');
    }

    function genPlan() {
        const type = document.getElementById('type').value;
        const plans = {
            "–†–µ—Ñ–µ—Ä–∞—Ç": "–¢–µ–º–∞:\n1. –í–≤–µ–¥–µ–Ω–∏–µ\n2. –ì–ª–∞–≤–∞ 1\n3. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n–ì–û–°–¢",
            "–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è": "–¢–µ–º–∞:\n–°–ª–∞–π–¥–æ–≤: \n–°—Ç–∏–ª—å: ",
            "–î–æ–∫–ª–∞–¥": "–¢–µ–º–∞:\n–¢–µ–∑–∏—Å—ã:\n–®—Ä–∏—Ñ—Ç: 14"
        };
        document.getElementById('details').value = plans[type] || "–¢–µ–º–∞:\n–î–µ—Ç–∞–ª–∏:";
        update();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function update() {
        const type = document.getElementById('type').value,
              count = document.getElementById('count').value,
              dateInput = document.getElementById('date'),
              dateValue = dateInput.value,
              price = document.getElementById('price').value,
              det = document.getElementById('details').value,
              urg = document.getElementById('urgent');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ä–æ—á–Ω–æ—Å—Ç—å (—Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞)
        if (dateValue.length >= 4 && dateValue.includes('.')) {
            const [d, m] = dateValue.split('.').map(Number);
            const now = new Date();
            const inputDate = new Date(now.getFullYear(), m - 1, d);
            const diff = (inputDate - now) / (1000 * 60 * 60 * 24);
            if (diff <= 1 && diff >= -1) {
                if (!urg.checked) { urg.checked = true; tg.HapticFeedback.notificationOccurred('warning'); }
                dateInput.classList.add('urgent-input');
            } else { dateInput.classList.remove('urgent-input'); }
        }

        let fields = [count, dateValue, price, det].filter(x => x.length > 0).length;
        document.getElementById('p-bar').style.width = (fields / 4 * 100) + '%';
        document.getElementById('unit-label').innerText = type.includes("–ü—Ä–µ–∑") ? "–°–ª–∞–π–¥–æ–≤" : "–°—Ç—Ä–∞–Ω–∏—Ü";
        
        const preview = document.getElementById('preview');
        if (count && price) {
            preview.classList.add('show');
            let h = urg.checked ? 'üö® –°–†–û–ß–ù–´–ô –ó–ê–ö–ê–ó üö®\n' : '';
            preview.innerText = `${h}1. –í–∏–¥: ${type}\n2. –ö–æ–ª-–≤–æ: ${count}\n3. –î–µ–¥–ª–∞–π–Ω: ${dateValue || '‚Äî'}\n4. –°—É–º–º–∞: ${price} ‚ÇΩ\n5. –î–µ—Ç–∞–ª–∏: ${det || '–Ω–µ—Ç'}\n---\n‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ 100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É.`;
        } else { preview.classList.remove('show'); }
    }

    async function copy() {
        if (!document.getElementById('count').value || !document.getElementById('price').value) {
            tg.showAlert("–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ü–µ–Ω—É!"); return;
        }
        await navigator.clipboard.writeText(document.getElementById('preview').innerText);
        tg.HapticFeedback.notificationOccurred('success');
        tg.showConfirm("–ê–Ω–∫–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –ù–∞–ø–∏—Å–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é?", (ok) => {
            if (ok) tg.openTelegramLink("https://t.me/awarem");
        });
    }

    function clearAll() {
        tg.showConfirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë?", (ok) => {
            if (ok) {
                document.querySelectorAll('input, textarea').forEach(el => el.value = '');
                document.getElementById('urgent').checked = false;
                update();
            }
        });
    }

    setWelcome();
    update();
</script>
</body>
</html>
