<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Order App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #ffffff; --sec-bg: #f4f4f5; --text: #000000; --hint: #707579;
            --card-border: rgba(0,0,0,0.1); --accent: #3390ec; --accent-red: #ff3b30; --accent-green: #34c759;
            --toggle-off: #dee2e6;
        }
        [data-theme="dark"] {
            --bg: #1c1c1d; --sec-bg: #2c2c2e; --text: #ffffff; --hint: #8e8e93; 
            --card-border: rgba(255,255,255,0.1); --toggle-off: #3a3a3c;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 16px; transition: 0.3s; }
        .app-container { display: flex; flex-direction: column; gap: 12px; }
        .card { background: var(--sec-bg); border-radius: 16px; padding: 14px; border: 1px solid var(--card-border); transition: 0.3s; }
        body:has(.card:focus-within) .card:not(:focus-within) { opacity: 0.5; filter: blur(0.5px); transform: scale(0.98); }
        .card:focus-within { transform: scale(1.02); border-color: var(--accent); box-shadow: 0 0 15px rgba(51, 144, 236, 0.2); }
        input, select, textarea { background: var(--bg); border: 1px solid var(--card-border); border-radius: 10px; color: var(--text); font-size: 16px; padding: 10px; width: 100%; box-sizing: border-box; outline: none; }
        label { font-size: 10px; color: var(--hint); font-weight: 800; text-transform: uppercase; margin-bottom: 6px; display: block; }
        #p-bar { position: fixed; top: 0; left: 0; height: 3px; background: var(--accent); width: 0%; transition: 0.3s; z-index: 100; }
        .main-btn { background: var(--accent); color: white; border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: 700; width: 100%; cursor: pointer; }
        .secondary-btn { background: var(--sec-bg); border: 1px solid var(--card-border); color: var(--accent); padding: 10px; border-radius: 12px; font-size: 13px; font-weight: 600; text-align: center; cursor: pointer; }
        .preview-box { background: var(--sec-bg); border: 1px dashed var(--accent); border-radius: 12px; padding: 12px; font-family: monospace; font-size: 12px; white-space: pre-line; display: none; }
        .preview-box.show { display: block; }
    </style>
</head>
<body>
    <div id="p-bar"></div>
    <div id="app" class="app-container"></div>

<script>
const OrderApp = {
    state: {
        type: '–†–µ—Ñ–µ—Ä–∞—Ç', count: '', date: '', price: '', details: '', theme: 'light'
    },
    tg: window.Telegram.WebApp,

    init() {
        this.tg.expand();
        this.loadState();
        this.render();
        this.applyTheme();
        this.setWelcomeStatus();
        this.syncUI();
    },

    render() {
        document.getElementById('app').innerHTML = `
            <div style="display: flex; gap: 10px;">
                <div class="secondary-btn" style="flex:1" onclick="OrderApp.open('https://t.me/txtandpptx')">üì¢ –ö–∞–Ω–∞–ª</div>
                <div class="secondary-btn" style="flex:1" onclick="OrderApp.open('https://t.me/OTZblBblawarem')">‚≠ê –û—Ç–∑—ã–≤—ã</div>
                <div class="secondary-btn" style="width: 42px; border-radius: 50%" onclick="OrderApp.toggleTheme()">‚òÄÔ∏è</div>
            </div>
            <div class="card"><div id="status-text" style="font-size: 12px; font-weight: 800; color: var(--accent-green);">–°—Ç–∞—Ç—É—Å...</div></div>
            <div class="card">
                <label>–í–∏–¥ —Ä–∞–±–æ—Ç—ã</label>
                <select id="f-type" onchange="OrderApp.updateState('type', this.value)">
                    <option value="–†–µ—Ñ–µ—Ä–∞—Ç">üìù –†–µ—Ñ–µ—Ä–∞—Ç</option>
                    <option value="–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è">üìä –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</option>
                    <option value="–î–æ–∫–ª–∞–¥">üé§ –î–æ–∫–ª–∞–¥</option>
                </select>
                <div style="display: flex; gap: 10px; margin-top: 12px;">
                    <div style="flex: 1"><label id="l-count">–°—Ç—Ä–∞–Ω–∏—Ü</label>
                    <input type="number" id="f-count" placeholder="0" oninput="OrderApp.updateState('count', this.value)"></div>
                    <div style="flex: 1"><label>–î–µ–¥–ª–∞–π–Ω</label>
                    <input type="text" id="f-date" placeholder="18.02" oninput="OrderApp.updateState('date', this.value)"></div>
                </div>
            </div>
            <div class="card">
                <label>–î–µ—Ç–∞–ª–∏</label>
                <textarea id="f-details" rows="3" placeholder="–¢–µ–º–∞..." oninput="OrderApp.updateState('details', this.value)"></textarea>
                <div style="margin-top: 12px"><label>–ë—é–¥–∂–µ—Ç (‚ÇΩ)</label>
                <input type="text" id="f-price" placeholder="500" oninput="OrderApp.updateState('price', this.value)"></div>
            </div>
            <div class="preview-box" id="preview"></div>
            <button class="main-btn" onclick="OrderApp.copyOrder()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—É</button>
            <div class="secondary-btn" style="color: var(--accent-red)" onclick="OrderApp.clearAll()">üóë –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</div>
        `;
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        Object.keys(this.state).forEach(key => {
            const el = document.getElementById('f-' + key);
            if (el) el.value = this.state[key];
        });
    },

    updateState(key, value) {
        this.state[key] = value;
        localStorage.setItem('order_state', JSON.stringify(this.state));
        this.syncUI();
    },

    loadState() {
        const saved = localStorage.getItem('order_state');
        if (saved) this.state = { ...this.state, ...JSON.parse(saved) };
    },

    syncUI() {
        const { type, count, date, price, details } = this.state;
        document.getElementById('l-count').innerText = type === '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è' ? "–°–ª–∞–π–¥–æ–≤" : "–°—Ç—Ä–∞–Ω–∏—Ü";
        const filled = [count, date, price].filter(Boolean).length;
        document.getElementById('p-bar').style.width = (filled / 3 * 100) + '%';
        const preview = document.getElementById('preview');
        if (count && price) {
            preview.classList.add('show');
            preview.innerText = `1. –í–∏–¥: ${type}\n2. –ö–æ–ª-–≤–æ: ${count}\n3. –î–µ–¥–ª–∞–π–Ω: ${date || '‚Äî'}\n4. –°—É–º–º–∞: ${price} ‚ÇΩ\n5. –î–µ—Ç–∞–ª–∏: ${details || '–Ω–µ—Ç'}\n---\n‚úÖ –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 100%`;
        } else preview.classList.remove('show');
    },

    copyOrder() {
        const text = document.getElementById('preview').innerText;
        if (!this.state.count) return this.tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É!");
        navigator.clipboard.writeText(text);
        this.tg.HapticFeedback.notificationOccurred('success');
        this.tg.showConfirm("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –ù–∞–ø–∏—Å–∞—Ç—å @awarem?", (ok) => ok && this.open("https://t.me/awarem"));
    },

    clearAll() {
        this.tg.showConfirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?", (ok) => {
            if (ok) { localStorage.removeItem('order_state'); location.reload(); }
        });
    },

    toggleTheme() {
        this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
        localStorage.setItem('order_state', JSON.stringify(this.state));
        this.applyTheme();
        this.tg.HapticFeedback.impactOccurred('medium');
    },

    applyTheme() { document.body.setAttribute('data-theme', this.state.theme); },
    
    setWelcomeStatus() {
        const h = new Date().getHours();
        const msg = h < 12 ? "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! ‚òï" : h < 18 ? "–ù–∞ —Å–≤—è–∑–∏ ‚òÄÔ∏è" : "–†–∞–±–æ—Ç–∞—é üåô";
        document.getElementById('status-text').innerText = `–°—Ç–∞—Ç—É—Å: ${msg}`;
    },

    open(url) { this.tg.openTelegramLink(url); }
};

OrderApp.init();
</script>
</body>
</html>

